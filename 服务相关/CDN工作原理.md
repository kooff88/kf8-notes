## CDN工作原理

内容分发网络( Content Delivery Network, 简称 CDN ) 是建立并覆盖再承载网之上， 由分布再不同区域的边缘节点服务器  
群组成的分布式网络。  

CND 应用广泛， 支持多种行业， 多种场景内容加速， 例如：图片小文件， 大文件下载， 视音频点播，直播流媒体，全站加速， 安全加速。  

借用阿里云 官网的例子， 来简单介绍 CDN 的工作原理。  

假设 通过 CDN加速的域名为  www.a.com, 接入 CDN网络， 开始使用加速服务后， 当终端用户（北京）发起 HTTP请求时，处理流程如下：  

1. 当终端用户（北京） 向 www.a.com 下的指定资源发起请求时，首先向 LDNS( 本地 DNS ) 发起域名解析请求。

2. LDNS 检查缓存中是否由 www.a.com 的IP地址记录。 如果由直接返回给终端用户；如果没有，则向授权 DNS查询。

3. 当 授权 DNS 解析 www.a.com 时，返回域名 CNAME www.a.tbcdn.com对应IP地址。 

4. 域名解析请求发送至 阿里云 DNS 调度系统，并为请求分配最佳节点 IP地址。

5. LDNS 获取 DNS 返回的解析 IP地址。  

6. 用户获取解析IP地址。

7. 用户向获取的IP地址发起对该资源的访问请求。  


如果该IP地址对应的节点已缓存该资源，则会将数据直接返回给用户，例如，图中步骤7和8，请求结束。

如果该IP地址对应的节点未缓存该资源，则节点向源站发起对该资源的请求。获取资源后，结合用户自定义配置的缓存策略，将资源缓存至节点，  
例如，图中的北京节点，并返回给用户，请求结束  


从这个例子可以了解到：

1. CDN的加速资源是跟域名绑定的。

2. 通过域名访问资源，首先是通过DNS分查找离用户最近的CDN节点（边缘服务器）的IP

3. 通过IP访问实际资源时，如果CDN上并没有缓存资源，则会到源站请求资源，并缓存到CDN节点上，这样，用户下一次访问时，该CDN节点就会有对应资源的缓存了。
